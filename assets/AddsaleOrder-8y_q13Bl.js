import{K as Z,aZ as ee,j as e,F as r,O as j,r as d,J as V,M as D,as as xe,L as he,z as g,A as m,at as T,I as K,S as _e}from"./index-oOAl86Au.js";/* empty css                  */import{u as ge}from"./index-Bf6BMNh7.js";import{h as Q}from"./moment-C5S46NFB.js";import{R as je,F as ye,B as X,S as se,I as R}from"./index-uwieu2qO.js";import{I as Y}from"./InputGroup-d10etdYG.js";import{D as be}from"./DropdownButton-CdSdTbY5.js";import{D as fe}from"./Dropdown-B0dFDphc.js";import"./asyncToGenerator-BfWTt6ZC.js";import"./InputGroupContext-KZaL2JS1.js";import"./NavbarContext-KPyz8Hxr.js";import"./DefaultLayout-rZAaeNBy.js";import"./index.esm-C59Ujb9G.js";import"./Container-B41Ve0--.js";import"./hook-BLdZHS6p.js";import"./index-C99xeW2a.js";import"./Anchor-BuCSZ2b3.js";const{Option:Se}=se,ve=()=>{const{control:I}=Z(),{accountType:F,setAccountType:y,productslist:b,setProductslist:E,data:h,commissionOptions:P,selectedCommission:k,setSelectedCommission:G,adjustment:w,setAdjustment:A,shipping:B,setShipping:z,subTotal:M,commissionAmount:$,totalAmount:U,handleAdditem:f,handleDeleteitem:_,handleCalculate:p}=ee();console.log(b,"productslist");const S=[{title:"Drag",dataIndex:"drag",render:()=>e.jsx("span",{className:"drag-handle",style:{cursor:"grab"},children:"â˜°"}),responsive:["xs","sm","md","lg","xl"]},{title:"ITEM DETAILS",dataIndex:"item",render:(o,a)=>e.jsx(j,{name:`item-${a.item}`,control:I,rules:{required:"Select or add a Customer"},render:({field:l})=>e.jsx(se,{...l,value:a.item,options:b,placeholder:"Select or add a Customer",onChange:u=>p(a,"item",u),style:{minWidth:150},children:b.length===0&&e.jsx(Se,{value:"Select Your Product",children:"Select Your Product"})})}),responsive:["sm"]},{title:"QUANTITY",dataIndex:"quantity",render:(o,a)=>e.jsx(R,{type:"number",value:a.quantity,onChange:l=>p(a,"quantity",Number(l.target.value)),style:{width:"100px"}}),responsive:["xs","sm","md","lg","xl"]},{title:"RATE",dataIndex:"rate",render:(o,a)=>e.jsx(R,{type:"number",value:a.rate,onChange:l=>p(a,"rate",Number(l.target.value)),style:{width:"100px"}}),responsive:["xs","sm","md","lg","xl"]},{title:"DISCOUNT %",dataIndex:"discount",render:(o,a)=>e.jsx(R,{type:"number",value:a.discount,onChange:l=>p(a,"discount",Number(l.target.value)),style:{width:"100px"}}),responsive:["xs","sm","md","lg","xl"]},{title:"AMOUNT",dataIndex:"amount",render:(o,a)=>e.jsx("span",{children:a.amount.toFixed(2)}),responsive:["sm","md","lg","xl"]},{title:"ACTION",key:"action",render:(o,a)=>e.jsx(X,{onClick:()=>_(a.key),danger:!0,children:"Delete"}),responsive:["xs","sm","md","lg","xl"]}],v={onDragEnd(o,a){const l=[...h],u=l.splice(o,1)[0];l.splice(a,0,u)},handleSelector:".drag-handle"};return e.jsxs("div",{children:[e.jsx("h6",{className:"mt-3",children:"Product List"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsx(je,{...v,children:e.jsx(ye,{columns:S,pagination:!1,dataSource:h,scroll:{x:"max-content"}})})}),e.jsx(X,{type:"primary",onClick:f,style:{marginTop:10},children:"Add Item"}),e.jsxs("div",{className:"p-3 mb-5 border rounded",style:{width:"400px",marginTop:"20px"},children:[e.jsx("h6",{children:e.jsx("strong",{children:"Sub Total"})}),e.jsx("p",{className:"text-end fw-bold",children:M.toFixed(2)}),e.jsx(r.Group,{children:e.jsxs("div",{children:[e.jsx(r.Check,{inline:!0,label:"TDC",type:"radio",value:"TDC",checked:F==="TDC",onChange:()=>y("TDC")}),e.jsx(r.Check,{inline:!0,label:"TCS",type:"radio",value:"TCS",checked:F==="TCS",onChange:()=>y("TCS")})]})}),e.jsxs(Y,{className:"mb-2",children:[e.jsx(be,{title:k.label,variant:"outline-secondary",id:"commission-dropdown",children:P.map((o,a)=>e.jsx(fe.Item,{onClick:()=>G(o),children:o.label},a))}),e.jsxs("span",{className:"ms-2",children:[" - ",$.toFixed(2)]})]}),e.jsx("p",{className:"text-muted small",children:k.label}),e.jsxs(Y,{className:"mb-2",children:[e.jsx(r.Control,{placeholder:"Adjustment",disabled:!0}),e.jsx(r.Control,{type:"number",value:w,onChange:o=>A(parseFloat(o.target.value)||0)})]}),e.jsxs(Y,{className:"mb-2",children:[e.jsx(r.Control,{placeholder:"Shipping Charge",disabled:!0}),e.jsx(r.Control,{type:"number",value:B,onChange:o=>z(parseFloat(o.target.value)||0)})]}),e.jsx("hr",{}),e.jsx("h5",{children:e.jsx("strong",{children:"Total ( Rs. )"})}),e.jsx("p",{className:"text-end fw-bold",children:U.toFixed(2)})]})]})},Ge=()=>{const{accountType:I,productsitem:F,data:y,commissionOptions:b,shipping:E,selectedCommission:h,adjustment:P,subTotal:k,commissionAmount:G,totalAmount:w,productslist:A,setProductslist:B,handleAdditem:z,Products:M,handleDeleteitem:$,handleCalculate:U}=ee();d.useEffect(()=>{M()},[]);const f=y.map(s=>{const t=typeof s.item=="object"&&s.item!==null,n=t?s.item:A.find(c=>c.value===s.item);return{soi_name:n?n.label:s.item,soi_item_id:t?s.item.value:s.item,soi_quantity:s.quantity,soi_rate:s.rate.toFixed(2),soi_discount:String(s.discount),soi_amount:s.amount}});console.log(f,"dhfbdshfbhbgf");const _=localStorage.getItem("user_id"),[p,S]=d.useState(!1);d.useState(null);const v=localStorage.getItem("token"),[o,a]=d.useState(!1),[l,u]=d.useState("");d.useEffect(()=>{te()},[]);const te=async()=>{try{const s=await V.post("https://lunarsenterprises.com:5016/crm/list/customers",{},{headers:{Authorization:`Bearer ${v}`,user_id:_}});if(s.data.result===!0){const t=s.data.list.map(n=>({value:n.cu_id,label:`${n.cu_salutation} ${n.cu_first_name} ${n.cu_last_name}`.trim()}));J(t)}else console.error(s.data.message),J([])}catch(s){console.error("Error fetching products:",s)}},{register:x,handleSubmit:re,watch:W,reset:ae,control:C,setValue:O,formState:{errors:i}}=Z({defaultValues:{files:[]}});W("contacts");const ne=async s=>{S(!0),console.log(s,N);try{const t=new FormData;N&&N.length>0&&N.forEach(c=>{t.append("image",c)}),t.append("user_id",_),t.append("so_selected_name",h.label),t.append("so_selected_tax",h.rate),s.so_customer_name&&(t.append("so_customer_name",s.so_customer_name.label),t.append("so_customer_id",s.so_customer_name.value)),t.append("so_sales_order_id",s.so_sales_order_id),t.append("so_reference",s.so_reference),t.append("so_order_date",Q(s.so_order_date,"DD-MM-YYYY").format("YYYY-MM-DD")),t.append("so_shipment_date",Q(s.so_shipment_date,"DD-MM-YYYY").format("YYYY-MM-DD")),s.so_payment_terms&&t.append("so_payment_terms",s.so_payment_terms.label),s.so_delivery_method&&t.append("so_delivery_method",s.so_delivery_method.label),s.so_salesperson_name&&(t.append("so_salesperson_name",s.so_salesperson_name.label),t.append("so_salesperson_id",s.so_salesperson_name.value)),t.append("so_customer_notes",s.so_customer_notes),t.append("so_shipping_charge",E),t.append("so_adjustment_amount",P),t.append("so_tds_tcs",I),t.append("so_total_amount",w),t.append("so_terms_conditions",s.so_terms_conditions),t.append("sales_order_items",JSON.stringify(f)),console.log([...t]);const n=await V.post("https://lunarsenterprises.com:5016/crm/add/sales-order",t,{headers:{Authorization:`Bearer ${v}`,user_id:_}});n.data.result===!0?(console.log("Success:",n.data),u({type:"success",message:n.data.message}),a(!0),ae(),setTimeout(()=>{a(!1),navigate("/dashboard")},3e3)):(console.warn("Failed:",n.data.message),u({type:"fail",message:n.data.message}),a(!0),setTimeout(()=>{a(!1)},3e3))}catch(t){console.error("Submission Error:",t),u({type:"fail",message:"Something went wrong. Please try again."}),a(!0),setTimeout(()=>{a(!1)},3e3)}finally{S(!1)}};d.useState(!1),d.useState(null),d.useState([{Salutation:"Mr.",FirstName:"John",LastName:"Doe",Email:"john@example.com",WorkPhone:"1234567890",Mobile:"9876543210"}]);const[q,H]=d.useState([]),oe=d.useCallback(s=>{const t=s.map(n=>{let c="";return n.type.startsWith("image/")&&(c=URL.createObjectURL(n)),{file:n,preview:c}});H(n=>{const c=[...n,...t];return O("files",c.map(L=>L.file)),c})},[O]),{getRootProps:le,getInputProps:ie}=ge({accept:{"image/*":[],"application/pdf":[]},multiple:!0,onDrop:oe}),de=s=>{H(t=>{const n=t.filter((c,L)=>L!==s);return O("files",n.map(c=>c.file)),n})},N=W("files"),ce=[{value:"  Net 15",label:"  Net 15"},{value:"  Net 30",label:"  Net 30"},{value:"Due end of the month",label:" Due end of the month "}],me=[{value:"Cryil",label:" Cryil"},{value:"Antony",label:"Antony"},{value:"Kavya",label:" Kavya "}],pe=[{value:"Online",label:"Online"},{value:"Hand Over",label:"Hand Over"}],[ue,J]=d.useState([]);return d.useState([{id:1,name:"Jaison",sku:"22",description:"Good",quantity:1,rate:300,discount:0,stock:"100 kg"},{id:2,name:"",sku:"",description:"",quantity:1,rate:0,discount:0,stock:""},{id:3,name:"",sku:"",description:"",quantity:1,rate:0,discount:0,stock:""}]),e.jsxs(e.Fragment,{children:[e.jsxs(D,{show:o,onHide:()=>a(!1),centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsxs(D.Title,{children:[l.type==="success"?e.jsx("img",{src:xe,alt:"Tick",style:{width:"30px",marginRight:"10px"}}):e.jsx("img",{src:he,alt:"Warning",style:{width:"30px",marginRight:"10px"}}),l.type==="success"?"Success":"Warning"]})}),e.jsx(D.Body,{children:e.jsx("p",{children:l.message})})]}),e.jsxs(r,{onSubmit:re(ne),children:[e.jsx("h4",{children:"Sales Order"}),e.jsxs(g,{children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"industries",className:"mt-2",children:[e.jsx(r.Label,{children:"Customer Name*"}),e.jsx(j,{name:"so_customer_name",control:C,rules:{required:"Select or  add a Customer"},render:({field:s})=>e.jsx(T,{...s,options:ue,isClearable:!0,isSearchable:!0,placeholder:"Select or  add a Customer",classNamePrefix:"react-select"})}),i.so_customer_name&&e.jsx("p",{className:"text-danger",children:i.so_customer_name.message})]})}),e.jsxs(m,{md:6,children:[e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Sale Order *"}),e.jsx(r.Control,{type:"text",placeholder:"S0-0001",defaultValue:"S0-",maxLength:7,...x("so_sales_order_id",{required:"Sales Order Id is required",pattern:{value:/^S0-\d{4}$/,message:"Sales Order must be in the format S0-1234 (4 digits)"}})})]}),i.so_sales_order_id&&e.jsx("p",{className:"text-danger",children:i.so_sales_order_id.message})]})]}),e.jsxs(g,{children:[e.jsxs(m,{md:6,children:[e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Sale Order Date*"}),e.jsx(r.Control,{type:"date",...x("so_order_date",{required:"Sales Order Date is required"})})]}),i.so_order_date&&e.jsx("p",{className:"text-danger",children:i.so_order_date.message})]}),e.jsxs(m,{md:6,children:[e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Expected Shipment Data Order"}),e.jsx(r.Control,{type:"date",...x("so_shipment_date",{required:"Shipment Date is required"})})]}),i.so_shipment_date&&e.jsx("p",{className:"text-danger",children:i.so_shipment_date.message})]})]}),e.jsxs(g,{children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"so_payment_terms",className:"mt-2",children:[e.jsx(r.Label,{children:"Payment Terms"}),e.jsx(j,{name:"so_payment_terms",control:C,rules:{required:"Due On  Receipt"},render:({field:s})=>e.jsx(T,{...s,options:ce,isClearable:!0,isSearchable:!0,placeholder:"Due On  Receipt",classNamePrefix:"react-select"})}),i.so_payment_terms&&e.jsx("p",{className:"text-danger",children:i.so_payment_terms.message})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"receipt",className:"mt-2",children:[e.jsx(r.Label,{children:"Delivery Method"}),e.jsx(j,{name:"so_delivery_method",control:C,rules:{required:"Delivery Method Required"},render:({field:s})=>e.jsx(T,{...s,options:pe,isClearable:!0,isSearchable:!0,placeholder:"Delivery Method",classNamePrefix:"react-select"})}),i.so_delivery_method&&e.jsx("p",{className:"text-danger",children:i.so_delivery_method.message})]})})]}),e.jsxs(g,{children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Customer Notes"}),e.jsx(r.Control,{type:"textarea",...x("so_customer_notes")})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Terms Conditions"}),e.jsx(r.Control,{type:"text",...x("so_terms_conditions")})]})})]}),e.jsxs(g,{children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"so_salesperson_name",className:"mt-2",children:[e.jsx(r.Label,{children:"Sales Person"}),e.jsx(j,{name:"so_salesperson_name",control:C,rules:{required:"Sales Person is required"},render:({field:s})=>e.jsx(T,{...s,options:me,isClearable:!0,isSearchable:!0,placeholder:"Sales Person",classNamePrefix:"react-select"})}),i.so_salesperson_name&&e.jsx("p",{className:"text-danger",children:i.so_salesperson_name.message})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{className:"mt-2",children:[e.jsx(r.Label,{children:"Reference"}),e.jsx(r.Control,{type:"text",...x("so_reference")})]})})]}),e.jsx(ve,{}),e.jsx(r.Label,{children:"Add Image / PDF"}),e.jsxs(m,{md:6,children:[e.jsx("div",{...le(),style:{border:"2px dashed #d1d5db",borderRadius:"12px",marginTop:"25px",height:"300px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#6b7280",cursor:"pointer",transition:"border 0.2s ease-in-out"},onMouseEnter:s=>s.currentTarget.style.border="2px dashed #3b82f6",onMouseLeave:s=>s.currentTarget.style.border="2px dashed #d1d5db",children:e.jsxs("div",{className:" imagescroll",children:[e.jsx("input",{...ie()}),e.jsx("input",{type:"hidden",...x("files")}),q.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",justifyContent:"center"},children:q.map((s,t)=>e.jsxs("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"5px",textAlign:"center"},children:[s.preview?e.jsx("img",{src:s.preview,alt:`Uploaded ${t}`,style:{width:"150px",height:"150px",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0",borderRadius:"8px"}}):e.jsx("div",{style:{width:"150px",height:"150px",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0",borderRadius:"8px"},children:e.jsx("p",{children:"PDF File"})}),e.jsx(K,{variant:"danger",size:"sm",onClick:n=>{n.stopPropagation(),de(t)},style:{marginTop:"5px"},children:"Delete"})]},t))}),e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#3b82f6",marginTop:"10px",textAlign:"center"},children:"Click to Add"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/1829/1829586.png",alt:"Upload",style:{width:"150px",height:"150px",opacity:"0.7",marginBottom:"10px"}}),e.jsx("p",{style:{fontSize:"14px",marginBottom:"4px"},children:"Drag files here or"}),e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#3b82f6"},children:"Browse files"})]})]})}),q.length===0&&e.jsx("div",{style:{color:"red",marginTop:"8px",fontSize:"14px"},children:"âš  Please add an image or PDF before submitting!"})]}),e.jsx("div",{className:"text-center mb-5 ",children:e.jsx(K,{disabled:p,variant:"success",type:"submit",className:"w-100 mt-3",children:p?e.jsxs(e.Fragment,{children:[e.jsx(_e,{animation:"border",size:"sm",className:"me-2"}),"Save & Continue ..."]}):"Save & Continue"})})]})]})};export{Ge as default};
