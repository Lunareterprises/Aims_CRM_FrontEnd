import{av as se,r as o,J as b,K as ae,j as e,M as y,as as te,L as re,F as n,z as h,A as i,O as _,at as x,I as ne,S as le}from"./index-C8gZvUEL.js";/* empty css                  */import{u as oe}from"./index-B-JvwOOn.js";import{h as B}from"./moment-C5S46NFB.js";import{I as ce}from"./InputGroup-ChilhtIj.js";import"./InputGroupContext-C8uqFoQg.js";const L=[{value:"Google Pay",label:"Google Pay"},{value:"Bank",label:"Bank"},{value:"cash",label:"cash"}],g=[{value:"Trust",label:"Trust"},{value:"Bank",label:"Bank"},{value:"cash",label:"cash"}],$=[{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"AED",label:"AED"}],xe=()=>{var Y;const{ep_id:M}=se(),j=localStorage.getItem("user_id"),[k,A]=o.useState(!1);o.useState(null);const v=localStorage.getItem("token"),[E,d]=o.useState(!1),[S,N]=o.useState(""),[F,G]=o.useState([]),[C,R]=o.useState([]);o.useEffect(()=>{D(),q()},[]);const D=async()=>{try{const s=await b.post("https://lunarsenterprises.com:5016/crm/list/vendors",{},{headers:{Authorization:`Bearer ${v}`,user_id:j}});if(s.data.result===!0){const a=s==null?void 0:s.data.list.map(r=>({value:r.ve_id,label:`${r.ve_salutation} ${r.ve_first_name} ${r.ve_last_name}`.trim()}));G(a)}else console.error(s.data.message),G([])}catch(s){console.error("Error fetching products:",s)}},q=async()=>{try{const s=await b.post("https://lunarsenterprises.com:5016/crm/list/customers",{},{headers:{Authorization:`Bearer ${v}`,user_id:j}});if(s.data.result===!0){const a=s==null?void 0:s.data.list.map(r=>({value:r.cu_id,label:`${r.cu_salutation} ${r.cu_first_name} ${r.cu_last_name}`.trim()}));R(a)}else console.error(s.data.message),R([])}catch(s){console.error("Error fetching products:",s)}},[ie,T]=o.useState([]);o.useEffect(()=>{V()},[]);const V=async()=>{var a;const s={expense_id:M};try{const r=await b.post("https://lunarsenterprises.com:5016/crm/list/expenses",s,{headers:{Authorization:`Bearer ${v}`,user_id:j}});if(r.data.result===!0){const t=r.data.list[0];T([t]);const p={value:t==null?void 0:t.ep_vendor_id,label:t==null?void 0:t.ep_vendor_name},P=(g==null?void 0:g.find(c=>c.value===(t==null?void 0:t.ep_expense_account)))||{value:t==null?void 0:t.ep_expense_account,label:t==null?void 0:t.ep_expense_account},I=$.find(c=>c.value===t.ep_currency)||{value:t.ep_currency,label:t.ep_currency},Z=L.find(c=>c.value===t.ep_paid_through)||{value:t.ep_paid_through,label:t.ep_paid_through},ee=C.find(c=>c.value===t.ep_customer_id)||{value:t.ep_customer_id,label:t.ep_customer_name};U({ep_currency:I,ep_vendor_name:p,ep_expense_account:P,ep_paid_through:Z,ep_customer_name:ee,ep_date:t.ep_date?B(t.ep_date).format("YYYY-MM-DD"):"",ep_invoice:t.ep_invoice||"",ep_amount:t.ep_amount||"",ep_notes:t.ep_notes||"",documents:((a=t==null?void 0:t.documents)==null?void 0:a.map(c=>({pd_id:c.pd_id,pd_file:c.pd_file})))||[]})}else console.error(r.data.message),T([])}catch(r){console.error("Error fetching products:",r)}finally{}},{register:f,handleSubmit:z,watch:u,reset:U,control:m,setValue:w,formState:{errors:l}}=ae({defaultValues:{files:[],documents:[]}});u("contacts");const W=async s=>{A(!0),console.log("dataaaaa",s);try{const a=new FormData,r=u("documents");a.append("ep_id",M),r.forEach((p,P)=>{if(p.file)a.append("image",p.file);else if(p.pd_file){const I=new File([p.pd_file],`existing_image_${P}.jpg`,{type:"image/jpeg"});a.append(`${p.pd_id}`,I)}}),a.append("ep_date",B(s.ep_date,"DD-MM-YYYY").format("YYYY-MM-DD")),s.ep_customer_name&&(a.append("ep_customer_name",s.ep_customer_name.label),a.append("ep_customer_id",s.ep_customer_name.value)),a.append("ep_expense_account",s.ep_expense_account.label),a.append("ep_amount",s.ep_amount),s.ep_paid_through&&a.append("ep_paid_through",s.ep_paid_through.label),s.ep_vendor_name&&(a.append("ep_vendor_name",s.ep_vendor_name.label),a.append("ep_vendor_id",s.ep_vendor_name.value)),a.append("ep_invoice",s.ep_invoice),a.append("ep_notes",s.ep_notes);const t=await b.post("https://lunarsenterprises.com:5016/crm/edit/expenses",a,{headers:{Authorization:`Bearer ${v}`,user_id:j}});t.data.result===!0?(console.log("Success:",t.data),N({type:"success",message:t.data.message}),d(!0),setTimeout(()=>{d(!1)},3e3)):(console.warn("Failed:",t.message),N({type:"fail",message:t.data.message}),d(!0),setTimeout(()=>{d(!1)},3e3))}catch(a){console.error("Submission Error:",a),N({type:"fail",message:"Something went wrong. Please try again."}),d(!0),setTimeout(()=>{d(!1)},3e3)}finally{A(!1)}},[H,O]=o.useState([]),J=o.useCallback(s=>{const a=s.map(r=>({file:r,preview:URL.createObjectURL(r)}));O(r=>[...r,...a]),w("documents",[...u("documents"),...a])},[H,w,u]),{getRootProps:K,getInputProps:Q}=oe({accept:"image/*",multiple:!0,onDrop:J}),X=s=>{const a=u("documents").filter((r,t)=>t!==s);w("documents",a)};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{show:E,onHide:()=>d(!1),centered:!0,children:[e.jsx(y.Header,{closeButton:!0,children:e.jsxs(y.Title,{children:[S.type==="success"?e.jsx("img",{src:te,alt:"Tick",style:{width:"30px",marginRight:"10px"}}):e.jsx("img",{src:re,alt:"Warning",style:{width:"30px",marginRight:"10px"}}),S.type==="success"?"Success":"Warning"]})}),e.jsx(y.Body,{children:e.jsx("p",{children:S.message})})]}),e.jsxs(n,{onSubmit:z(W),children:[e.jsx("h4",{children:" Edit Expenses"}),e.jsxs(h,{children:[e.jsx(i,{md:6,children:e.jsxs(n.Group,{controlId:"ep_vendor_name",className:"mt-2",children:[e.jsx(n.Label,{children:"Vendor Name*"}),e.jsx(_,{name:"ep_vendor_name",control:m,rules:{required:"Select Vendor"},render:({field:s})=>e.jsx(x,{...s,options:F,isClearable:!0,isSearchable:!0,placeholder:"Select Vendor",classNamePrefix:"react-select",value:F.find(a=>{var r;return a.value===((r=s.value)==null?void 0:r.value)})||null,onChange:a=>s.onChange(a)})}),l.ep_vendor_name&&e.jsx("p",{className:"text-danger",children:l.ep_vendor_name.message})]})}),e.jsx(i,{md:6,children:e.jsxs(n.Group,{controlId:"ep_expense_account",className:"mt-2",children:[e.jsx(n.Label,{children:"Expense Account*"}),e.jsx(_,{name:"ep_expense_account",control:m,rules:{required:"Expense Account"},render:({field:s})=>e.jsx(x,{...s,options:g,isClearable:!0,isSearchable:!0,placeholder:"Expense Account",classNamePrefix:"react-select",value:g.find(a=>{var r;return a.value===((r=s.value)==null?void 0:r.value)})||null,onChange:a=>s.onChange(a)})}),l.ep_expense_account&&e.jsx("p",{className:"text-danger",children:l.ep_expense_account.message})]})})]}),e.jsxs(h,{children:[e.jsx(i,{md:6,children:e.jsxs(n.Group,{className:"mt-2",children:[e.jsx(n.Label,{children:"Amount*"}),e.jsxs(ce,{children:[e.jsx(_,{name:"ep_currency",control:m,render:({field:s})=>e.jsx(x,{...s,options:$,isClearable:!0,isSearchable:!0,placeholder:"Select Currency",classNamePrefix:"react-select",value:$.find(a=>{var r;return a.value===((r=s.value)==null?void 0:r.value)})||s.value||"select currency",onChange:a=>s.onChange(a)})}),e.jsx(n.Control,{type:"number",placeholder:"Enter amount",...f("ep_amount")}),l.ep_amount&&e.jsx("p",{className:"text-danger",children:l.ep_amount.message})]})]})}),e.jsx(i,{md:6,children:e.jsxs(n.Group,{controlId:"ep_payment_terms",className:"mt-2",children:[e.jsx(n.Label,{children:"Paid Through *"}),e.jsx(_,{name:"ep_paid_through",control:m,rules:{required:"Paid Through"},render:({field:s})=>e.jsx(x,{...s,options:L,isClearable:!0,isSearchable:!0,placeholder:"Paid Through",classNamePrefix:"react-select",value:L.find(a=>{var r;return a.value===((r=s.value)==null?void 0:r.value)})||null,onChange:a=>s.onChange(a)})}),l.ep_payment_terms&&e.jsx("p",{className:"text-danger",children:l.ep_payment_terms.message})]})})]}),e.jsxs(h,{children:[e.jsxs(i,{md:6,children:[e.jsxs(n.Group,{className:"mt-2",children:[e.jsx(n.Label,{children:"Date*"}),e.jsx(n.Control,{type:"date",...f("ep_date",{required:"Date is required"})})]}),l.ep_date&&e.jsx("p",{className:"text-danger",children:l.ep_date.message})]}),e.jsxs(i,{md:6,children:[e.jsxs(n.Group,{className:"mt-2",children:[e.jsx(n.Label,{children:" Invoice*"}),e.jsx(n.Control,{type:"text",placeholder:"S0-0001",defaultValue:"S0-",maxLength:7,...f("ep_invoice",{required:"Invoice  Id is required",pattern:{value:/^S0-\d{4}$/,message:"Invoice must be in the format S0-1234 (4 digits)"}})})]}),l.ep_invoice&&e.jsx("p",{className:"text-danger",children:l.ep_invoice.message})]})]}),e.jsxs(h,{children:[e.jsxs(i,{md:6,children:[e.jsxs(n.Group,{className:"mt-2",children:[e.jsx(n.Label,{children:"Notes"}),e.jsx(n.Control,{as:"textarea",rows:3,...f("ep_notes")})]}),l.ep_notes&&e.jsx("p",{className:"text-danger",children:l.ep_notes.message})]}),e.jsx(i,{md:6,children:e.jsxs(n.Group,{controlId:"industries",className:"mt-2",children:[e.jsx(n.Label,{children:"Customer Name*"}),e.jsx(_,{name:"ep_customer_name",control:m,rules:{required:"Select Customer"},render:({field:s})=>e.jsx(x,{...s,options:C,isClearable:!0,isSearchable:!0,placeholder:"Select Customer",classNamePrefix:"react-select",value:C.find(a=>{var r;return a.value===((r=s.value)==null?void 0:r.value)})||null,onChange:a=>s.onChange(a)})}),l.ep_customer_name&&e.jsx("p",{className:"text-danger",children:l.ep_customer_name.message})]})})]}),e.jsx(n.Label,{children:"Edit Image / Documents"}),e.jsxs(h,{children:[e.jsx(i,{md:6,children:e.jsx(n.Group,{className:"mb-3",children:e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[(Y=u("documents"))==null?void 0:Y.map((s,a)=>{const r=s.pd_file&&s.pd_file.toLowerCase().endsWith(".pdf")||s.file&&s.file.type==="application/pdf";return e.jsxs("div",{className:"position-relative me-2 mb-2",children:[r?e.jsx("div",{style:{width:"100px",height:"100px",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0",borderRadius:"8px"},children:e.jsx("p",{children:"PDF File"})}):e.jsx("img",{src:s.preview||`https://lunarsenterprises.com:5016/${s.pd_file}`,alt:"Vendor",style:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"8px"}}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm position-absolute",style:{top:5,right:5},onClick:()=>X(a),children:"✖"})]},s.pd_id||a)})," "]})})}),e.jsx(i,{md:6,className:"mb-5",children:e.jsxs("div",{...K(),style:{border:"2px dashed #d1d5db",borderRadius:"12px",padding:"20px",textAlign:"center",cursor:"pointer"},children:[e.jsx("input",{...Q()}),e.jsx("p",{children:"Drag & drop or click to upload images"})]})})]}),e.jsx("div",{className:"text-center mb-5 ",children:e.jsx(ne,{disabled:k,variant:"success",type:"submit",className:"w-100 mt-3",children:k?e.jsxs(e.Fragment,{children:[e.jsx(le,{animation:"border",size:"sm",className:"me-2"}),"Save & Continue ..."]}):"Save & Continue"})})]})]})};export{xe as default};
